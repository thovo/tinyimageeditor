"use strict";function showOptionCp(){var t=["cp-url","cp-img"];t.forEach(function(t){var e=document.getElementById(t).classList;show(e)})}function filterLayer(t){var e=document.getElementById("main-frame"),n=e.getContext("2d"),a=new Image;a.src=e.toDataURL(),n.drawImage(a,0,0,e.width,e.height),n.globalCompositeOperation="soft-light",window[t](n,e)}function filterPattern(t,e){var n=document.getElementById("main-frame"),a=n.getContext("2d");a.globalCompositeOperation="multiple";var o=new Image;o.src=n.toDataURL();var i={rainy:"https://3.bp.blogspot.com/-W__wiaHUjwI/Vt3Grd8df0I/AAAAAAAAA78/7xqUNj8ujtY/s1600/image02.png",forest:"http://10steps.sg/wp-content/uploads//2012/04/fantasy-photoshop-tutorial-12.jpg"},d=new Image;d.src=""==t?e:i[t],d.onload=function(){a.drawImage(d,0,0,n.width,n.height)},a.globalCompositeOperation="lighter",a.drawImage(o,0,0,n.width,n.height)}function rainbowFilter(t,e){var n=t.createLinearGradient(0,e.height,e.width,e.height);n.addColorStop(0,"rgba(255, 0, 0, 1.000)"),n.addColorStop(.333,"rgba(225, 255, 0, 1.000)"),n.addColorStop(.666,"rgba(0, 255, 17, 1.000)"),n.addColorStop(1,"rgba(0, 55, 255, 1.000)"),t.fillStyle=n,t.fillRect(0,0,e.width,e.height)}function show(t){t.contains("hide")&&(t.add("show"),t.remove("hide"))}function hide(t){t.contains("show")&&(t.add("hide"),t.remove("show"))}!function(){function t(){return document.getElementById("main-frame").getContext("2d")}function e(){w.addEventListener("click",u,!1),y.addEventListener("change",h,!1),E.addEventListener("click",s,!1),I.addEventListener("click",l,!1);for(var t=0;t<L.length;t++)L[t].addEventListener("click",n,!1)}function n(t){var e=t.target.id,n={};p.width>0&&p.height>0&&(n=v.getImageData(0,0,p.width,p.height),b.push(v.getImageData(0,0,p.width,p.height))),B[e](n)}function a(t){for(var e=t.data,n=e.length,a=0;a<n;a+=4){var o=e[a],i=e[a+1],d=e[a+2];e[a]=.393*o+.769*i+.189*d,e[a+1]=.349*o+.686*i+.168*d,e[a+2]=.272*o+.534*i+.131*d}g(t)}function o(t){for(var e=t.data,n=e.length,a=0;a<n;a+=4)e[a]+=50,e[a+1]+=50,e[a+2]+=50;g(t)}function i(t){for(var e=t.data,n=e.length,a=0;a<n;a+=4){var o=e[a],i=e[a+1],d=e[a+2];e[a]=e[a+1]=e[a+2]=(o+i+d)/3}g(t)}function d(t){for(var e=t.data,n=e.length,a=0;a<n;a+=4)e[a]=255-e[a],e[a+1]=255-e[a+1],e[a+2]=255-e[a+2];g(t)}function r(t,e){for(var n=t.data,a=n.length,o=0;o<a;o+=4)n[o+3]=n[o+3]*(e?.8:1.25);g(t)}function c(t){for(var e=t.data,n=e.length,a=0;a<n;a+=4){var o=.2126*e[a]+.7152*e[a+1]+.0722*e[a+2]>=128?255:0;e[a]=e[a+1]=e[a+2]=o}g(t)}function l(){b.length>0&&g(b.pop())}function g(t){v.putImageData(t,0,0)}function u(){y.click()}function h(){if(this.files&&this.files[0]){var t=new FileReader;t.onload=function(t){f.onload=function(){v.drawImage(f,0,0)},f.src=t.target.result},t.readAsDataURL(this.files[0])}}function s(){var t=p.toDataURL(),e=document.createElement("a"),n=document.createEvent("HTMLEvents");n.initEvent("click"),e.download="image.png",e.href=t,e.dispatchEvent(n)}function m(){e()}var f=new Image,p=document.getElementById("main-frame"),v=t(),w=document.getElementById("btn-upload"),E=document.getElementById("btn-download"),I=document.getElementById("btn-undo"),y=document.getElementById("input-upload"),L=document.getElementsByClassName("filter"),b=[],B={threshold:c,opacity:r,invert:d,grayScale:i,sepia:a,brightness:o};document.addEventListener("DOMContentLoaded",function(){m()},!1)}();var url_input=document.getElementById("cp-url");url_input.addEventListener("input",function(t){var e=document.getElementById("cp-url-app").classList,n=t.target.value;""!=n.length?(show(e),document.getElementById("cp-url-app").addEventListener("click",function(){filterPattern("",n)})):hide(e)});